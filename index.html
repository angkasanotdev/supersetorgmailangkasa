<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Setor Gmail Angkasa</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Inter", sans-serif; }
    body { background: #0f172a; color: #fff; display: flex; flex-direction: column; align-items: center; min-height: 100vh; padding-bottom: 60px; }
    .container { margin-top: 80px; background: #1e293b; padding: 30px; border-radius: 16px; box-shadow: 0 0 20px rgba(0,0,0,0.4); width: 90%; max-width: 420px; }
    h2 { text-align: center; margin-bottom: 20px; font-weight: 600; }
    input { width: 100%; padding: 12px; border: none; border-radius: 8px; margin: 8px 0; background: #334155; color: #fff; }
    button { width: 100%; padding: 12px; border: none; border-radius: 8px; background: #3b82f6; color: #fff; font-weight: 600; cursor: pointer; transition: 0.2s; }
    button:hover { background: #2563eb; }
    .card { background: #1e293b; border-radius: 12px; padding: 20px; margin-top: 16px; text-align: center; }
    .logout { margin-top: 12px; background: #ef4444; }
    .hidden { display: none; }
    .stat { display: flex; justify-content: space-between; margin: 8px 0; }
    .stat strong { color: #38bdf8; }
    #loading { margin-top: 20px; text-align: center; font-size: 14px; color: #94a3b8; }

    #modalSetor {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: none; align-items: center; justify-content: center;
      z-index: 10; opacity: 0; transition: opacity 0.3s ease;
    }
    #modalSetor.show { display: flex; opacity: 1; }
    .modal-content {
      background: #1e293b; padding: 20px; border-radius: 12px;
      width: 90%; max-width: 380px; text-align: center;
      box-shadow: 0 0 15px rgba(0,0,0,0.4);
      transform: scale(0.9); transition: transform 0.3s ease;
    }
    #modalSetor.show .modal-content { transform: scale(1); }
    .modal-content h3 { margin-bottom: 10px; }
    .close { background: #ef4444; margin-top: 10px; }

    /* === MODAL ERROR === */
    #modalError {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5); display: none;
      align-items: center; justify-content: center; z-index: 999;
    }
    #modalError.show { display: flex; animation: fadeIn 0.3s ease forwards; }
    .modal-error-content {
      background: #1e293b; padding: 25px 30px; border-radius: 12px;
      text-align: center; box-shadow: 0 0 20px rgba(0,0,0,0.4);
      animation: fadeInUp 0.3s ease;
    }
    .modal-error-content h3 { color: #ef4444; margin-bottom: 6px; }
    .modal-error-content p { color: #cbd5e1; font-size: 14px; }
    @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
    @keyframes fadeInUp { from {transform: translateY(20px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }
    
    #modalTutup {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: none; align-items: center; justify-content: center; z-index: 1000;
    }
    #modalTutup.show { display: flex; animation: fadeIn 0.3s ease forwards; }
    #modalTutup .modal-error-content {
      background: #1e293b; padding: 25px 30px; border-radius: 12px;
      text-align: center; color: #fff; box-shadow: 0 0 20px rgba(0,0,0,0.4);
      animation: fadeInUp 0.3s ease;
    }
    
    h1 { text-align: center; margin-top: 30px; margin-bottom: 15px; color: #38bdf8; font-weight: 600; }
    .panduan {
      background: #1e293b;
      border-radius: 12px;
      width: 90%;
      max-width: 420px;
      margin-top: 10px;
      padding: 10px 20px;
      text-align: justify;
      box-shadow: 0 0 15px rgba(0,0,0,0.3);
    }
    .panduan-item {
      border-bottom: 1px solid #334155;
      cursor: pointer;
      padding: 10px 0;
    }
    .panduan-item:last-child { border-bottom: none; }
    .panduan-item h3 {
      color: #93c5fd;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .panduan-item h3 span.arrow {
      font-size: 14px;
      transition: transform 0.3s ease;
    }
    .panduan-item.active h3 span.arrow {
      transform: rotate(180deg);
    }
    .panduan-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease, opacity 0.3s ease;
      opacity: 0;
    }
    .panduan-item.active .panduan-content {
      max-height: 500px;
      opacity: 1;
      margin-top: 8px;
    }

    footer {
      position: fixed; bottom: 0; width: 100%;
      background: #1e293b; color: #94a3b8;
      text-align: center; padding: 8px 0;
      font-size: 13px; border-top: 1px solid #334155;
    }
  </style>
</head>
<body>

  <div class="container" id="login">
    <h2>ğŸ” Login Setor Gmail</h2>
    <h2>By Angkasa</h2>
    <input type="text" id="username" placeholder="Username" />
    <input type="password" id="password" placeholder="Password" />
    <button onclick="login()">Masuk</button>
    <p id="loading" class="hidden">â³ Memeriksa akun...</p>
  </div>

  <div class="container hidden" id="dashboard">
    <h2>ğŸ“Š Dashboard Setor Gmail</h2>
    <div id="info"></div>
    <div class="card">
      <h3>ğŸ“ˆ Statistik</h3>
      <div class="stat"><span>Saldo:</span> <strong id="saldo">Rp0</strong></div>
      <div class="stat"><span>Total Gmail:</span> <strong id="total">0</strong></div>
      <div class="stat"><span>Convert:</span> <strong id="convert">0</strong></div>
      <div class="stat"><span>Unconvert:</span> <strong id="unconvert">0</strong></div>
      <div class="stat"><span>Withdraw:</span> <strong id="withdraw">0</strong></div>
    </div>
    <button onclick="openSetor()">ğŸ“© Setor Gmail</button>
    <button class="logout" onclick="logout()">Keluar</button>
  </div>

<div class="panduan hidden" id="panduan">
    <div class="panduan-item" onclick="togglePanduan(this)">
      <h3>ğŸ’Œ Panduan Setor Gmail <span class="arrow">â–¼</span></h3>
      <div class="panduan-content">
        <p>â€¢ ğš†ğ™°ğ™¹ğ™¸ğ™± ğ™¹ğ™¾ğ™¸ğ™½ ğ™¶ğšğ™¾ğš„ğ™¿ & ğ™²ğ™·ğ™°ğ™½ğ™½ğ™´ğ™»</p>
        <p>â€¢ ğ™¹ğ™¸ğ™ºğ™° ğ™¾ğš„ğšƒ ğ™¶ğšğ™¾ğš„ğ™¿ ğ™²ğ™·ğ™°ğ™½ğ™½ğ™´ğ™» ğ™°ğ™ºğš„ğ™½ ğ™°ğš„ğšƒğ™¾ ğ™³ğ™´ğ™»ğ™´ğšƒğ™´</p>
        <p>â€¢ ğ™¶ğ™¼ğ™°ğ™¸ğ™» ğš†ğ™°ğ™¹ğ™¸ğ™± ğ™µğšğ™´ğš‚ğ™·</p>
        <p>â€¢ ğ™°ğ™ºğš„ğ™½ ğ™¶ğ™¼ğ™°ğ™¸ğ™» ğš†ğ™°ğ™¹ğ™¸ğ™± ğ™½ğ™°ğ™¼ğ™° ğ™¼ğ™°ğ™½ğš„ğš‚ğ™¸ğ™°</p>
        <p> mâ€¢ ğ™°ğ™ºğš„ğ™½ ğšƒğ™¸ğ™³ğ™°ğ™º ğ™³ğ™¸ ğ™±ğš„ğ™°ğšƒ ğ™¼ğ™´ğ™½ğ™¶ğ™¶ğš„ğ™½ğ™°ğ™ºğ™°ğ™½ ğ™½ğ™¾ğ™¼ğ™¾ğš ğ™·ğ™¿</p>
        <p>â€¢ ğ™³ğ™¸ğ™±ğš„ğ™°ğšƒ ğ™³ğ™¸ ğ™°ğ™¿ğ™º ğ™¶ğ™¼ğ™°ğ™¸ğ™» ğ™»ğ™°ğ™½ğ™¶ğš‚ğš„ğ™½ğ™¶</p>
        <p>â€¢ ğš„ğš‚ğ™´ğšğ™½ğ™°ğ™¼ğ™´ ğš†ğ™°ğ™¹ğ™¸ğ™± ğ™±ğ™´ğ™³ğ™° ğš‚ğ™´ğšƒğ™¸ğ™°ğ™¿ ğ™¶ğ™¼ğ™°ğ™¸ğ™»</p>
        <p>â€¢ ğ™¿ğ™°ğš‚ğš‚ğš†ğ™¾ğšğ™³ ğš†ğ™°ğ™¹ğ™¸ğ™± "ğ™°ğ™½ğ™¶ğ™ºğ™°ğš‚ğ™°ğ™¶ğ™¼ğ™°ğ™¸ğ™»"</p>
        <p>â€¢ ğ™°ğ™½ğ™¶ğ™ºğ™° ğ™³ğ™¸ğ™±ğ™´ğ™»ğ™°ğ™ºğ™°ğ™½ğ™¶ ğš„ğš‚ğ™´ğšğ™½ğ™°ğ™¼ğ™´ ğš†ğ™°ğ™¹ğ™¸ğ™±</p>
        <p>â€¢ ğ™¼ğ™¸ğ™½ 1 ğ™¼ğ™°ğš‡ 3 ğ™½ğ™¾ğ™¼ğ™¾ğš </p>
        <p>â€¢ ğ™°ğ™ºğš„ğ™½ ğ™·ğ™°ğ™½ğšˆğ™° 1 ğ™ºğ™°ğ™»ğ™¸ ğš‚ğ™´ğšƒğ™¾ğš</p>
        <p>â€¢ ğ™°ğ™ºğš„ğ™½ ğš†ğ™°ğ™¹ğ™¸ğ™± ğ™³ğ™¸ ğ™»ğ™¾ğ™¶ğ™¾ğš„ğšƒ</p>
        <p>â€¢ ğ™¶ğ™´ğ™½ğ™³ğ™´ğš ğš†ğ™°ğ™¹ğ™¸ğ™± ğ™¼ğ™´ğ™¼ğ™¸ğ™»ğ™¸ğ™· ğšƒğ™¸ğ™³ğ™°ğ™º ğ™¼ğ™´ğ™±ğ™´ğšğ™¸ğšƒğ™°ğ™·ğš„</p>
        <p>â€¢ ğšƒğ™°ğ™·ğš„ğ™½ ğš†ğ™°ğ™¹ğ™¸ğ™± 2000 - 1950</p>
        <p>â€¢ ğš†ğ™´ğ™±ğš‚ğ™¸ğšƒğ™´ ğšƒğ™¸ğ™³ğ™°ğ™º ğ™°ğ™ºğ™°ğ™½ 24 ğ™¹ğ™°ğ™¼ ğ™°ğ™ºğ™°ğ™½ ğ™°ğ™³ğ™° ğ™²ğ™»ğ™¾ğš‚ğ™´ ğ™¾ğ™¿ğ™´ğ™½ ğ™½ğšˆğ™°</p>
        <p>â€¢ ğ™¿ğ™´ğ™½ğ™¶ğš„ğ™¼ğ™¿ğš„ğ™»ğ™°ğ™½ ğšƒğ™¸ğ™³ğ™°ğ™º ğ™°ğ™³ğ™° ğ™±ğ™°ğšƒğ™°ğš‚</p>
        <p>â€¢ ğ™³ğ™¸ğ™»ğ™°ğšğ™°ğ™½ğ™¶ ğš„ğ™±ğ™°ğ™· ğ™¿ğ™°ğš‚ğš‚ğš†ğ™¾ğšğ™³</p>
        <p>â€¢ ğ™³ğ™¸ğ™»ğ™°ğšğ™°ğ™½ğ™¶ ğš‚ğ™´ğšƒğ™¾ğš ğ™°ğ™ºğš„ğ™½ ğšˆğ™°ğ™½ğ™¶ ğ™¿ğ™´ğšğ™½ğ™°ğ™· ğ™³ğ™¸ ğš‚ğ™´ğšƒğ™¾ğšğ™ºğ™°ğ™½</p>
        <p>â€¢ ğ™³ğ™¸ğ™±ğš„ğ™°ğšƒ ğš†ğ™°ğ™¹ğ™¸ğ™± ğ™¼ğ™°ğ™½ğš„ğ™°ğ™» ğšƒğ™¸ğ™³ğ™°ğ™º ğ™¼ğ™´ğ™½ğ™¶ğ™¶ğš„ğ™½ğ™°ğ™ºğ™°ğ™½ ğšğ™¾ğšƒ/ğ™±ğ™¾ğšƒ ğ™³ğ™»ğ™»</p>
        <p>â€¢ ğ™½ğ™°ğ™¼ğ™° ğšƒğ™¸ğ™³ğ™°ğ™º ğ™¼ğ™´ğ™½ğ™¶ğ™°ğ™½ğ™³ğš„ğ™½ğ™¶ ğš„ğ™½ğš‚ğš„ğš ğš‚ğ™°ğšğ™° ğ™°ğšƒğ™°ğš„ ğ™¿ğ™´ğ™»ğ™´ğ™²ğ™´ğ™·ğ™°ğ™½</p>
        <p>â€¢ ğ™²ğ™¾ğ™½ğšƒğ™¾ğ™· ğ™±ğ™´ğ™½ğ™°ğš : azharmaulana71@gmail.com, julaihabadriah9@gmail.com</p>
        <p>â€¢ ğ™²ğ™¾ğ™½ğšƒğ™¾ğ™· ğš‚ğ™°ğ™»ğ™°ğ™· : anjaywhhwwi@gmail.com, azharwe@gmail.com</p>
        <p>â€¢ ğ™²ğ™¾ğ™½ğšƒğ™¾ğ™· ğš‚ğ™°ğ™»ğ™°ğ™· ğ™±ğ™´ğšğš„ğšğš„ğšƒğ™°ğ™½ : angkasa1@gmail.com, angkasa2@gmail.com</p>
      </div>
    </div>

    <div class="panduan-item" onclick="togglePanduan(this)">
      <h3>ğŸ’° Panduan Tarik Saldo <span class="arrow">â–¼</span></h3>
      <div class="panduan-content">
        <p>â€¢ ğš„ğ™½ğšƒğš„ğ™º ğšƒğ™°ğšğ™¸ğ™º ğš‚ğ™°ğ™»ğ™³ğ™¾ ğ™±ğ™¸ğš‚ğ™° ğ™³ğ™´ğ™½ğ™¶ğ™°ğ™½ ğ™ºğ™´ğšƒğ™¸ğ™º :</p>
        <p>â€¢ /ğš‚ğšƒğ™°ğšğšƒ ğ™³ğ™¸ @supergmailangkasabot</p>
        <p>â€¢ ğ™¿ğ™¸ğ™»ğ™¸ğ™· ğšƒğ™¾ğ™¼ğ™±ğ™¾ğ™» ğ™²ğ™¾ğ™½ğš…ğ™´ğšğšƒ</p>
        <p>â€¢ ğ™¼ğ™°ğš‚ğš„ğ™ºğ™°ğ™½ ğ™¹ğš„ğ™¼ğ™»ğ™°ğ™· ğ™¶ğ™¼ğ™°ğ™¸ğ™» ğšˆğ™°ğ™½ğ™¶ ğ™¸ğ™½ğ™¶ğ™¸ğ™½ ğ™³ğ™¸ ğ™²ğ™¾ğ™½ğš…ğ™´ğšğšƒ ğ™ºğ™´ ğšğš„ğ™¿ğ™¸ğ™°ğ™·</p>
        <p>â€¢ ğ™¿ğ™¸ğ™»ğ™¸ğ™· ğšƒğ™¾ğ™¼ğ™±ğ™¾ğ™» ğšƒğ™°ğšğ™¸ğ™º </p>
        <p>â€¢ ğ™¼ğ™°ğš‚ğš„ğ™ºğ™°ğ™½ ğ™½ğ™¾ğ™¼ğ™¸ğ™½ğ™°ğ™» ğšˆğ™°ğ™½ğ™¶ ğ™¸ğ™½ğ™¶ğ™¸ğ™½ ğ™³ğ™¸ ğšƒğ™°ğšğ™¸ğ™º</p>
        <p>â€¢ ğ™¼ğ™°ğš‚ğš„ğ™ºğ™°ğ™½ ğ™½ğ™¾ğ™¼ğ™¾ğš ğšğ™´ğ™ºğ™´ğ™½ğ™¸ğ™½ğ™¶ ğ™³ğ™°ğ™½ğ™°/ğ™¶ğ™¾ğ™¿ğ™°ğšˆ</p>
        <p>â€¢ ğšƒğš„ğ™½ğ™¶ğ™¶ğš„ ğ™¾ğš†ğ™½ğ™´ğš ğš„ğ™½ğšƒğš„ğ™º ğ™¿ğ™´ğ™½ğ™¶ğ™´ğ™²ğ™´ğ™ºğ™°ğ™½ ğ™¶ğ™¼ğ™°ğ™¸ğ™»</p>
        <p>â€¢ ğ™¹ğ™¸ğ™ºğ™° ğ™°ğ™³ğ™° ğ™¶ğ™¼ğ™°ğ™¸ğ™» ğ™²ğ™°ğ™²ğ™°ğšƒ ğ™°ğ™ºğš„ğ™½ ğ™³ğ™¸ ğ™ºğš„ğšğ™°ğ™½ğ™¶ ğ™¹ğš„ğ™¼ğ™»ğ™°ğ™· ğ™¶ğ™¼ğ™°ğ™¸ğ™»</p>
        <p>â€¢ ğ™¼ğ™¸ğš‚ğ™°ğ™» : 20 ğ™°ğ™ºğš„ğ™½ ğšˆğ™°ğ™½ğ™¶ ğ™¶ğ™°ğ™º ğ™±ğ™¸ğš‚ğ™° ğ™»ğ™¾ğ™¶ğ™¸ğ™½ 2, ğ™¹ğ™°ğ™³ğ™¸ 18 ğš‡ 300 = ğšğ™¿5.400</p>
        <p>â€¢ ğš„ğ™½ğšƒğš„ğ™º ğ™¿ğ™´ğ™½ğ™°ğšğ™¸ğ™ºğ™°ğ™½ ğš†ğ™°ğ™ºğšƒğš„ ğ™°ğ™ºğ™°ğ™½ ğ™³ğ™¸ ğšƒğ™´ğ™½ğšƒğš„ğ™ºğ™°ğ™½ ğ™¾ğ™»ğ™´ğ™· ğ™¾ğš†ğ™½ğ™´ğš</p>
        <p>â€¢ ğ™¹ğ™¸ğ™ºğ™° ğ™¿ğ™´ğ™½ğ™¶ğ™´ğ™²ğ™´ğ™ºğ™°ğ™½ ğ™±ğ™´ğšğ™·ğ™°ğš‚ğ™¸ğ™» ğ™¾ğš†ğ™½ğ™´ğš ğ™°ğ™ºğ™°ğ™½ ğšƒğšğ™°ğ™½ğš‚ğ™µğ™´ğš</p>
        <p>â€¢ ğš„ğ™½ğšƒğš„ğ™º ğ™²ğ™¾ğ™½ğš…ğ™´ğšğšƒ ğ™³ğ™°ğšğ™¸ 1 ğ™°ğ™ºğš„ğ™½ 1 ğš‡ 300ğ™¿</p>
      </div>
    </div>
  </div>

  <div id="modalSetor">
    <div class="modal-content">
      <h3>ğŸ“¤ Setor Gmail</h3>
      <input type="text" id="gmail" placeholder="Email Gmail" />
      <input type="password" id="gmailPass" placeholder="Password Gmail" />
      <button onclick="kirimSetor()">Kirim</button>
      <button class="close" onclick="closeSetor()">Batal</button>
      <p id="statusSetor" style="font-size:13px;color:#9ca3af;margin-top:10px"></p>
    </div>
  </div>

  <div id="modalError">
    <div class="modal-error-content">
      <h3>âŒ Login Gagal</h3>
      <p>Username atau password salah!</p>
    </div>
  </div>
  
  <div id="modalTutup">
    <div class="modal-error-content">
      <h3>ğŸš« Website Sedang Tutup</h3>
      <p>Website sementara tidak menerima setor Gmail. Silakan coba lagi nanti.</p>
    </div>
  </div>
  
  <footer>Â© 2025 Super Setor Gmail Angkasa</footer>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBnd_oT956r-6qOfy3tmOeG94-XsQd9WSY",
      authDomain: "database-super.firebaseapp.com",
      projectId: "database-super",
      storageBucket: "database-super.firebasestorage.app",
      messagingSenderId: "241219754589",
      appId: "1:241219754589:web:77674efdd4597eb7968bb4",
      measurementId: "G-4ML339N7Q0"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const BOT_TOKEN = "8534291925:AAGZIdtyDA6X8wJyC4JUuaaA2Km8bq5hnRQ";
    const OWNER_ID = "6736986837";
    const formatRupiah = n => 'Rp' + (Number(n)||0).toLocaleString('id-ID');

    function togglePanduan(el) {
      el.classList.toggle('active');
    }

    function showError(msg){
      const modal=document.getElementById('modalError');
      modal.querySelector('p').textContent=msg;
      modal.classList.add('show');
      setTimeout(()=>modal.classList.remove('show'),2000);
    }

    async function login(){
      const u=document.getElementById('username').value.trim();
      const p=document.getElementById('password').value.trim();
      const loading=document.getElementById('loading');
      if(!u||!p)return showError("Isi username & password!");
      loading.classList.remove('hidden');
      const snap=await db.collection('users').where('username_login','==',u).where('password_login','==',p).limit(1).get();
      loading.classList.add('hidden');
      if(snap.empty)return showError("Username atau password salah!");
      const doc=snap.docs[0];
      const user=doc.data();
      localStorage.setItem('uid', doc.id);
      localStorage.setItem('user', JSON.stringify({ ...user, id: doc.id }));
      showDashboard(user);
    }

    function showDashboard(user) {
  document.getElementById("login").classList.add("hidden");
  document.getElementById("dashboard").classList.remove("hidden");

  const uid = user.id || localStorage.getItem("uid");
  if (!uid) return alert("Gagal memuat data user (UID kosong)");

  const info = document.getElementById("info");
  info.innerHTML = `<p>ğŸ‘‹ Halo <strong>${user.username_login || "-"}</strong> (@${user.username_tele || "-"})</p>`;

  db.collection("users").doc(String(uid)).onSnapshot((doc) => {
    if (!doc.exists) return;
    const u = doc.data();
    document.getElementById("saldo").textContent = formatRupiah(u.saldo || 0);
    document.getElementById("total").textContent = u.emails_total || 0;
    document.getElementById("convert").textContent = u.emails_converted || 0;
    document.getElementById("unconvert").textContent = u.emails_unconverted || 0;
    document.getElementById("withdraw").textContent = u.withdraw_count || 0;
    document.getElementById("panduan").classList.remove("hidden");
  });
}
    
    // === Pantau status website realtime ===
const statusRef = db.collection("system").doc("status");

statusRef.onSnapshot((doc) => {
  if (!doc.exists) return;
  const data = doc.data();
  const modalTutup = document.getElementById('modalTutup');
  const semuaButton = document.querySelectorAll('button');

  if (data.website_open === false) {
    // Kalau website ditutup
    modalTutup.classList.add('show');
    semuaButton.forEach(btn => btn.disabled = true);
  } else {
    // Kalau website dibuka lagi
    modalTutup.classList.remove('show');
    semuaButton.forEach(btn => btn.disabled = false);
  }
});
    
    function logout(){
      localStorage.clear();
      closeSetor();
      document.getElementById('dashboard').classList.add('hidden');
      document.getElementById('login').classList.remove('hidden');
      document.getElementById("panduan").classList.add("hidden");
    }

    function openSetor(){
      const user=localStorage.getItem('user');
      if(!user)return showError("Login dulu sebelum setor Gmail!");
      document.getElementById('modalSetor').classList.add('show');
    }
    function closeSetor(){
      const m=document.getElementById('modalSetor');
      m.classList.remove('show');
      document.getElementById('gmail').value='';
      document.getElementById('gmailPass').value='';
      document.getElementById('statusSetor').textContent='';
    }

    async function kirimSetor() {
      const email = document.getElementById("gmail").value.trim().toLowerCase();
      const pass = document.getElementById("gmailPass").value.trim();
      const status = document.getElementById("statusSetor");
      const saved = JSON.parse(localStorage.getItem("user") || "{}");
      const userId = saved.id;
      const now = new Date();
      const startOfDay = new Date(now);
      startOfDay.setHours(0, 0, 0, 0);
      const endOfDay = new Date(now);
      endOfDay.setHours(23, 59, 59, 999);

      const setorHariIni = await db.collection("emails")
        .doc(String(userId))
        .collection("gmail_list")
        .where("createdAt", ">=", startOfDay)
        .where("createdAt", "<=", endOfDay)
        .get();

      if (setorHariIni.size >= 80) {
        return showError("Kamu sudah mencapai batas 80 Gmail hari ini! Coba lagi setelah 00.00 WIB.");
      }
      if (!email || !pass) return showError("Isi semua data Gmail dan Password!");
      if (!userId) return showError("Login dulu sebelum setor Gmail!");

      const gmailRegex = /^[a-zA-Z0-9._%+-]+@gmail\.com$/;
        if (!gmailRegex.test(email)) return showError("Format email tidak valid (harus @gmail.com)!");

      const bannedEmails = ["tanpa@gmail.com", "contoh@gmail.com", "test@gmail.com", "example@gmail.com"];
        if (bannedEmails.includes(email)) return showError("Email ini tidak diterima, gunakan Gmail asli!");

      const snap = await db.collection("emails").doc(String(userId)).collection("gmail_list")
        .where("email", "==", email).limit(1).get();
      if (!snap.empty) return showError("Email ini sudah pernah disetor!");

      const lastSnap = await db.collection("emails").doc(String(userId)).collection("gmail_list")
        .orderBy("createdAt", "desc").limit(1).get();
      if (!lastSnap.empty) {
        const lastEmail = lastSnap.docs[0].data().email;
        const clean1 = email.replace(/[^a-zA-Z]/g, "");
        const clean2 = lastEmail.replace(/[^a-zA-Z]/g, "");
      if (clean1 === clean2) return showError("Email terlalu mirip dengan sebelumnya!");
      }

      status.textContent = "â³ Mengirim data Gmail...";
        try {
          await db.collection("emails").doc(String(userId)).collection("gmail_list").add({
            email, password: pass, converted: false,
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        });

      const pesan = `<blockquote>ğŸ™‹â€â™‚ï¸ Om Ada Yang Setor Nih\nğŸ“© Detail Gmail Baru\nğŸ‘¤ User: ${saved.username_login || "-"}\nğŸ†” ID: ${userId}\nğŸ“§ Gmail: ${email}\nğŸ”‘ Password: ${pass}</blockquote>`;
        await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ chat_id: OWNER_ID, text: pesan, parse_mode: "HTML" }),
      });

      const userRef = db.collection("users").doc(String(userId));
        await userRef.update({
          total_akun: firebase.firestore.FieldValue.increment(1),
          emails_total: firebase.firestore.FieldValue.increment(1),
          emails_unconverted: firebase.firestore.FieldValue.increment(1),
      });

      status.textContent = "ğŸŸ¢ Gmail berhasil disetor!";
      setTimeout(closeSetor, 1500);
      } catch (e) {
        console.error(e);
        status.textContent = "ğŸ”´ Gagal setor Gmail!";
        }
      }

      window.onload = async () => {
        document.getElementById('login').classList.remove('hidden');
        document.getElementById('dashboard').classList.add('hidden');
        document.getElementById('modalSetor').classList.remove('show');
        const saved = localStorage.getItem('user');
        if (!saved) return;
        try {
          const user = JSON.parse(saved);
          const doc = await db.collection('users')
            .where('username_login','==',user.username_login)
            .where('password_login','==',user.password_login)
            .limit(1).get();
          if (!doc.empty) showDashboard(doc.docs[0].data());
          else localStorage.clear();
        } catch (e) {
          console.error("Auto login error:", e);
          localStorage.clear();
        }
      };
    </script>
  </body>
</html>
